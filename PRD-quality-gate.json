{
  "name": "P6: Quality Gate Integration",
  "version": "1.0.0",
  "project": "krolik-cli",
  "description": "Add post-task quality gate that runs krolik_audit after each successful task",
  "tasks": [
    {
      "id": "quality-gate-types",
      "title": "Define quality gate types and interfaces",
      "description": "Create TypeScript types for quality gate configuration and results in src/lib/@felix/executor/quality-gate.ts",
      "priority": "high",
      "type": "feature",
      "context": {
        "files": ["src/lib/@felix/executor/types.ts", "src/lib/@felix/executor/validation.ts"]
      },
      "acceptance_criteria": [
        "Create QualityGateConfig interface with enabled, auditMode, failOnIssues fields",
        "Create QualityGateResult interface with passed, issues, summary fields",
        "Export types from index.ts"
      ],
      "validation": {
        "steps": ["typecheck"]
      }
    },
    {
      "id": "quality-gate-runner",
      "title": "Implement quality gate runner function",
      "description": "Add runQualityGate function that calls krolik_audit and parses results",
      "priority": "high",
      "type": "feature",
      "dependsOn": ["quality-gate-types"],
      "context": {
        "files": ["src/lib/@felix/executor/quality-gate.ts", "src/commands/audit/index.ts"]
      },
      "acceptance_criteria": [
        "Function accepts projectRoot and QualityGateConfig",
        "Runs audit in 'pre-commit' mode by default",
        "Returns QualityGateResult with parsed issues",
        "Handles errors gracefully (returns passed=true on error)"
      ],
      "validation": {
        "steps": ["typecheck"]
      }
    },
    {
      "id": "quality-gate-integration",
      "title": "Integrate quality gate into task runner",
      "description": "Call quality gate after successful task validation in task-runner.ts",
      "priority": "high",
      "type": "feature",
      "dependsOn": ["quality-gate-runner"],
      "context": {
        "files": [
          "src/lib/@felix/executor/task-runner.ts",
          "src/lib/@felix/executor/quality-gate.ts"
        ]
      },
      "acceptance_criteria": [
        "Add qualityGate field to ExecutorConfig",
        "Run quality gate after validation passes",
        "Log quality gate results",
        "Mark task as failed if failOnIssues=true and issues found"
      ],
      "validation": {
        "steps": ["typecheck"]
      }
    }
  ]
}
