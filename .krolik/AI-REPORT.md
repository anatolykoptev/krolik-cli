# AI Code Quality Report

> Generated by krolik-cli at 2025-12-24T03:11:38.367Z

## Summary

| Metric | Value |
|--------|-------|
| Total Issues | 100 |
| Auto-fixable | 7 |
| Manual Required | 93 |
| Total Effort | 39h 6min |

### By Priority

- ðŸ”´ **CRITICAL**: 2 issues
- ðŸŸ  **HIGH**: 15 issues
- ðŸŸ¡ **MEDIUM**: 75 issues
- ðŸŸ¢ **LOW**: 8 issues

### Tech Stack

TypeScript, Zod

---

## âš ï¸ AI Rules (Read First!)

> **IMPORTANT:** Before starting any work, read these files for project-specific rules and conventions.

- `CLAUDE.md` (root)

---

## Git Status

- **Branch:** `dev`
- **Changes:** 83 modified, 37 untracked, 1 staged

### Recent Commits

- `d60c715` feat(status): add AI-friendly output with next-action and do-not sections *(23 hours ago)*
- `9638e1a` refactor(lib): migrate to @namespace structure *(26 hours ago)*
- `489142e` fix(refine): check monorepo root for lockfile and README *(26 hours ago)*

---

## ðŸŽ¯ Next Action

**ðŸ”´ Read AI rules files: CLAUDE.md**

> Project has AI configuration files that define conventions and rules

---

## ðŸš« Do Not

- Do not commit without running typecheck first
- Do not push directly to main/master branch
- Do not ignore TypeScript errors with @ts-ignore
- Do not use magic numbers â€” extract to named constants
- Do not write functions longer than 50 lines â€” extract helper functions
- Do not export more than 5 items per file â€” split into modules
- Do not leave console.log in production code

---

## Quick Wins

These issues can be auto-fixed in seconds:

- [ ] `/Users/anatoliikoptev/CascadeProjects/piternow_project/krolik-cli/src/mcp/server.ts:122` â€” Unexpected console statement: console.log (1 min)
- [ ] `tests/commands/fix/helpers.ts:115` â€” Unexpected console statement (1 min)
- [ ] `tests/commands/fix/helpers.ts:173` â€” Unexpected console statement (1 min)
- [ ] `/Users/anatoliikoptev/CascadeProjects/piternow_project/krolik-cli/tests/commands/fix/helpers.ts:115` â€” Unexpected console statement: console.warn (1 min)
- [ ] `/Users/anatoliikoptev/CascadeProjects/piternow_project/krolik-cli/tests/commands/fix/helpers.ts:173` â€” Unexpected console statement: console.warn (1 min)
- [ ] `/Users/anatoliikoptev/CascadeProjects/piternow_project/krolik-cli/src/lib/@patterns/lint.ts:45` â€” Unexpected debugger statement (1 min)
- [ ] `/Users/anatoliikoptev/CascadeProjects/piternow_project/krolik-cli/src/lib/@patterns/lint.ts:129` â€” Unexpected debugger statement (1 min)

---

## Hotspot Files

Files with the most issues:

| File | Issues | Priority |
|------|--------|----------|
| `src/lib/@patterns/hardcoded.ts` | 22 | ðŸŸ  high |
| `src/mcp/tools.ts` | 13 | ðŸ”´ critical |
| `src/lib/@sanitize/index.ts` | 10 | ðŸŸ  high |
| `tests/commands/fix/helpers.ts` | 8 | ðŸŸ¡ medium |
| `src/mcp/resources.ts` | 7 | ðŸŸ¡ medium |

---

## Issues by Priority

### ðŸ”´ Critical Issues (Fix Immediately)

> These issues may cause build failures or runtime errors
> **Effort**: 2h | **Auto-fixable**: 0/2

- [ ] `src/mcp/tools.ts:241` â€” Function "runTool" has complexity 29 (max: 10) (1h)
- [ ] `src/bin/cli.ts:52` â€” Function "createProgram" has complexity 37 (max: 10) (1h)

### ðŸŸ  High Priority Issues

> These issues should be addressed in the current sprint
> **Effort**: 15h | **Auto-fixable**: 0/15

- [ ] `src/index.ts` â€” File exports 7 items (max: 5) (1h)
- [ ] `src/types/config.ts` â€” File exports 9 items (max: 5) (1h)
- [ ] `src/types/commands.ts` â€” File exports 25 items (max: 5) (1h)
- [ ] `src/lib/index.ts` â€” File exports 20 items (max: 5) (1h)
- [ ] `src/config/domains.ts` â€” File exports 6 items (max: 5) (1h)
- [ ] `src/config/detect.ts` â€” File exports 6 items (max: 5) (1h)
- [ ] `src/config/defaults.ts` â€” File exports 8 items (max: 5) (1h)
- [ ] `src/commands/index.ts` â€” File exports 13 items (max: 5) (1h)
- [ ] `krolik-cli/tests/commands/fix/helpers.ts` â€” File has 11 functions (max: 10) (1h)
- [ ] `krolik-cli/tests/commands/fix/helpers.ts` â€” File exports 11 items (max: 5) (1h)
- [ ] `src/lib/@shell/shell.ts` â€” File exports 8 items (max: 5) (1h)
- [ ] `src/lib/@sanitize/index.ts` â€” File has 14 functions (max: 10) (1h)
- [ ] `src/lib/@sanitize/index.ts` â€” File exports 17 items (max: 5) (1h)
- [ ] `src/lib/@patterns/lint.ts` â€” File exports 12 items (max: 5) (1h)
- [ ] `src/lib/@patterns/hardcoded.ts` â€” File exports 14 items (max: 5) (1h)

### ðŸŸ¡ Medium Priority Issues

> Address these for better maintainability
> **Effort**: 21h 55min | **Auto-fixable**: 0/75

- [ ] `src/mcp/types.ts:52` â€” Hardcoded number: 32601 (10 min)
- [ ] `src/mcp/tools.ts:241` â€” Function "runTool" has 109 lines (max: 50) (40 min)
- [ ] `src/mcp/tools.ts:257` â€” Excessive nesting depth: 5 (max: 4) (40 min)
- [ ] `src/mcp/tools.ts:265` â€” Excessive nesting depth: 5 (max: 4) (40 min)
- [ ] `src/mcp/tools.ts:289` â€” Excessive nesting depth: 5 (max: 4) (40 min)
- ... and 70 more issues

### ðŸŸ¢ Low Priority Issues (Optional)

> Nice to fix but not urgent
> **Effort**: 11 min | **Auto-fixable**: 7/8

- [ ] `src/mcp/server.ts:122` â€” Unexpected console statement: console.log (1 min) [AUTO]
- [ ] `src/mcp/server.ts:25` â€” Unused import: entire import from './tools' is unused (4 min)
- [ ] `tests/commands/fix/helpers.ts:115` â€” Unexpected console statement (1 min) [AUTO]
- [ ] `tests/commands/fix/helpers.ts:173` â€” Unexpected console statement (1 min) [AUTO]
- [ ] `krolik-cli/tests/commands/fix/helpers.ts:115` â€” Unexpected console statement: console.warn (1 min) [AUTO]
- ... and 3 more issues

---

## Recommended Action Plan

Execute these steps in order:

#### step-1: ðŸ”„ REFACTOR ðŸ”´

**File**: `src/mcp/tools.ts:241`
**Effort**: 1h

Function "runTool" has complexity 29 (max: 10)

**Current code:**
```typescript
  236:  * @param name - Tool name (krolik_status, krolik_context, etc.)
  237:  * @param args - Tool arguments
  238:  * @param projectRoot - Project root directory
  239:  * @returns Tool execution result as string
  240:  */
â†’ 241: export function runTool(
  242:   name: string,
  243:   args: Record<string, unknown>,
  244:   projectRoot: string,
  245: ): string {
  246:   switch (name) {
```

**Suggested fix:**
```diff
+ Refactor into smaller functions, use strategy pattern, or extract conditions
```

> Fix complexity issue

#### step-2: ðŸ”„ REFACTOR ðŸ”´

**File**: `src/bin/cli.ts:52`
**Effort**: 1h

Function "createProgram" has complexity 37 (max: 10)

**Current code:**
```typescript
   47: }
   48: 
   49: /**
   50:  * Create main CLI program
   51:  */
â†’  52: function createProgram(): Command {
   53:   const program = new Command();
   54: 
   55:   program
   56:     .name('krolik')
   57:     .description('KROLIK â€” fast AI-assisted development toolkit (AI-friendly output by default)')
```

**Suggested fix:**
```diff
+ Refactor into smaller functions, use strategy pattern, or extract conditions
```

> Fix complexity issue

#### step-3: ðŸ”„ REFACTOR ðŸŸ 

**File**: `src/index.ts`
**Effort**: 1h

File exports 7 items (max: 5)

<details>
<summary>ðŸ’¡ Show suggested fix</summary>

```diff
+ Group related exports into separate modules with index.ts re-exports
```

> Fix srp issue

</details>

#### step-4: ðŸ”„ REFACTOR ðŸŸ 

**File**: `src/types/config.ts`
**Effort**: 1h

File exports 9 items (max: 5)

<details>
<summary>ðŸ’¡ Show suggested fix</summary>

```diff
+ Group related exports into separate modules with index.ts re-exports
```

> Fix srp issue

</details>

#### step-5: ðŸ”„ REFACTOR ðŸŸ 

**File**: `src/types/commands.ts`
**Effort**: 1h

File exports 25 items (max: 5)

<details>
<summary>ðŸ’¡ Show suggested fix</summary>

```diff
+ Group related exports into separate modules with index.ts re-exports
```

> Fix srp issue

</details>

---

## File Contexts

Detailed information about affected files:

### `src/lib/@patterns/hardcoded.ts`

- **Purpose**: Module (main: shouldSkipFile)
- **Type**: util
- **Metrics**: 245 lines, 6 functions, avg complexity 2

**Exports**: `DETECTION_PATTERNS`, `FIXABLE_PATTERNS`, `ACCEPTABLE_NUMBERS`, `CONST_DECL_PATTERN`, `SKIP_FILE_PATTERNS`, `SKIP_URL_PATTERNS`, `KNOWN_CONSTANTS`, `KEYWORD_TO_CONST_NAME`, `shouldSkipFile`, `shouldSkipLine`, `isAcceptableNumber`, `shouldSkipUrl`, `getKnownConstantName`, `getConstNameFromKeyword`

### `src/mcp/tools.ts`

- **Purpose**: Module (main: runTool)
- **Type**: util
- **Metrics**: 350 lines, 5 functions, avg complexity 10

**Exports**: `TOOLS`, `runTool`

**Imports**: `node:child_process`, `node:url`, `./types`

### `src/lib/@sanitize/index.ts`

- **Purpose**: Module (main: sanitizeFeatureName)
- **Type**: util
- **Metrics**: 217 lines, 14 functions, avg complexity 5

**Exports**: `ValidationResult`, `sanitizeFeatureName`, `sanitizePathComponent`, `sanitizeIdentifier`, `sanitizeIssueNumber`, `sanitizePort`, `sanitizePositiveInt`, `escapeShellArg`, `escapeDoubleQuotes`, `isValidCommandName`, `isValidUrl`, `sanitizeUrl`, `isValidEmail`, `sanitizeEmail`, `parseBoolean`, `escapeRegex`, `escapeReplacement`, `literalReplacer`, `normalizeToRelative`, `validatePathWithinProject`, `validatePathOrThrow`, `isPathSafe`, `type PathValidationResult`

### `tests/commands/fix/helpers.ts`

- **Purpose**: Module (main: createTestFixer)
- **Type**: test
- **Metrics**: 289 lines, 11 functions, avg complexity 4

**Exports**: `createTestFixer`, `createTestIssue`, `createTestOperation`, `withTempFile`, `createTestContent`, `assertFixOperation`, `mockConsole`, `SEVERITY`, `CATEGORY`, `DIFFICULTY`

**Imports**: `../../../src/commands/fix/core/types`

### `src/mcp/resources.ts`

- **Purpose**: Module (main: getResources)
- **Type**: util
- **Metrics**: 113 lines, 2 functions, avg complexity 6

**Exports**: `getResources`, `ResourceContent`, `getResource`

**Imports**: `./types`

---

*Use `krolik fix --ai-execute AI-REPORT.md` to execute this plan automatically.*
