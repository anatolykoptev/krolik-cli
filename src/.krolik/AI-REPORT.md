# AI Code Quality Report

> Generated by krolik-cli at 2025-12-24T02:28:49.427Z

## Summary

| Metric | Value |
|--------|-------|
| Total Issues | 100 |
| Auto-fixable | 6 |
| Manual Required | 94 |
| Total Effort | 35h 2min |

### By Priority

- ðŸ”´ **CRITICAL**: 5 issues
- ðŸŸ  **HIGH**: 13 issues
- ðŸŸ¡ **MEDIUM**: 78 issues
- ðŸŸ¢ **LOW**: 4 issues

---

## Git Status

- **Branch:** `dev`
- **Changes:** 78 modified, 36 untracked, 1 staged

### Recent Commits

- `d60c715` feat(status): add AI-friendly output with next-action and do-not sections *(22 hours ago)*
- `9638e1a` refactor(lib): migrate to @namespace structure *(25 hours ago)*
- `489142e` fix(refine): check monorepo root for lockfile and README *(26 hours ago)*

---

## ðŸŽ¯ Next Action

**ðŸ”´ Fix 5 critical issue(s) immediately**

> Critical issues may cause runtime errors or security vulnerabilities

---

## ðŸš« Do Not

- Do not commit without running typecheck first
- Do not push directly to main/master branch
- Do not ignore TypeScript errors with @ts-ignore
- Do not use `any` type â€” use proper type definitions
- Do not use magic numbers â€” extract to named constants
- Do not write functions longer than 50 lines â€” extract helper functions
- Do not export more than 5 items per file â€” split into modules
- Do not leave console.log in production code

---

## Quick Wins

These issues can be auto-fixed in seconds:

- [ ] `mcp/server.ts:122` â€” Unexpected console statement (1 min)
- [ ] `/Users/anatoliikoptev/CascadeProjects/piternow_project/krolik-cli/src/mcp/server.ts:122` â€” Unexpected console statement: console.log (1 min)
- [ ] `/Users/anatoliikoptev/CascadeProjects/piternow_project/krolik-cli/src/lib/@patterns/lint.ts:128` â€” Unexpected debugger statement (1 min)
- [ ] `bin/cli.ts:356` â€” Unexpected debugger statement (2 min)
- [ ] `lib/@patterns/lint.ts:128` â€” Unexpected debugger statement (2 min)
- [ ] `/Users/anatoliikoptev/CascadeProjects/piternow_project/krolik-cli/src/bin/cli.ts:283` â€” @ts-ignore suppresses TypeScript errors (5 min)

---

## Hotspot Files

Files with the most issues:

| File | Issues | Priority |
|------|--------|----------|
| `lib/@patterns/hardcoded.ts` | 28 | ðŸŸ¡ medium |
| `mcp/tools.ts` | 9 | ðŸŸ¡ medium |
| `mcp/resources.ts` | 7 | ðŸŸ¡ medium |
| `src/lib/@sanitize/index.ts` | 6 | ðŸŸ  high |
| `src/mcp/tools.ts` | 4 | ðŸ”´ critical |

---

## Issues by Priority

### ðŸ”´ Critical Issues (Fix Immediately)

> These issues may cause build failures or runtime errors
> **Effort**: 2h 9min | **Auto-fixable**: 3/5

- [ ] `src/mcp/tools.ts:241` â€” Function "runTool" has complexity 29 (max: 10) (1h)
- [ ] `src/bin/cli.ts:52` â€” Function "createProgram" has complexity 33 (max: 10) (1h)
- [ ] `bin/cli.ts:356` â€” Unexpected debugger statement (2 min) [AUTO]
- [ ] `src/bin/cli.ts:283` â€” @ts-ignore suppresses TypeScript errors (5 min) [AUTO]
- [ ] `lib/@patterns/lint.ts:128` â€” Unexpected debugger statement (2 min) [AUTO]

### ðŸŸ  High Priority Issues

> These issues should be addressed in the current sprint
> **Effort**: 13h | **Auto-fixable**: 0/13

- [ ] `src/index.ts` â€” File exports 7 items (max: 5) (1h)
- [ ] `src/types/config.ts` â€” File exports 9 items (max: 5) (1h)
- [ ] `src/types/commands.ts` â€” File exports 25 items (max: 5) (1h)
- [ ] `src/lib/index.ts` â€” File exports 20 items (max: 5) (1h)
- [ ] `src/config/domains.ts` â€” File exports 6 items (max: 5) (1h)
- [ ] `src/config/detect.ts` â€” File exports 6 items (max: 5) (1h)
- [ ] `src/config/defaults.ts` â€” File exports 8 items (max: 5) (1h)
- [ ] `src/commands/index.ts` â€” File exports 13 items (max: 5) (1h)
- [ ] `src/lib/@shell/shell.ts` â€” File exports 7 items (max: 5) (1h)
- [ ] `src/lib/@sanitize/index.ts` â€” File has 14 functions (max: 10) (1h)
- [ ] `src/lib/@sanitize/index.ts` â€” File exports 15 items (max: 5) (1h)
- [ ] `src/lib/@patterns/lint.ts` â€” File exports 12 items (max: 5) (1h)
- [ ] `src/lib/@patterns/hardcoded.ts` â€” File exports 14 items (max: 5) (1h)

### ðŸŸ¡ Medium Priority Issues

> Address these for better maintainability
> **Effort**: 19h 46min | **Auto-fixable**: 0/78

- [ ] `src/mcp/types.ts:52` â€” Hardcoded number: 32601 (10 min)
- [ ] `src/mcp/tools.ts:241` â€” Function "runTool" has 109 lines (max: 50) (40 min)
- [ ] `mcp/tools.ts:257` â€” Excessive nesting depth: 5 (max: 4) (40 min)
- [ ] `mcp/tools.ts:265` â€” Excessive nesting depth: 5 (max: 4) (40 min)
- [ ] `mcp/tools.ts:289` â€” Excessive nesting depth: 5 (max: 4) (40 min)
- ... and 73 more issues

### ðŸŸ¢ Low Priority Issues (Optional)

> Nice to fix but not urgent
> **Effort**: 7 min | **Auto-fixable**: 3/4

- [ ] `mcp/server.ts:122` â€” Unexpected console statement (1 min) [AUTO]
- [ ] `src/mcp/server.ts:122` â€” Unexpected console statement: console.log (1 min) [AUTO]
- [ ] `src/mcp/server.ts:25` â€” Unused import: entire import from './tools' is unused (4 min)
- [ ] `src/lib/@patterns/lint.ts:128` â€” Unexpected debugger statement (1 min) [AUTO]

---

## Recommended Action Plan

Execute these steps in order:

#### step-1: ðŸ”§ FIX ðŸ”´

**File**: `bin/cli.ts:356`
**Effort**: 2 min

Unexpected debugger statement

**Current code:**
```typescript
  351:         typecheckOnly: options.typecheckOnly,
  352:         noTypecheck: options.typecheck === false,
  353:         backup: presetOptions.backup ?? options.backup,
  354:         // Fixer flags
  355:         fixConsole: options.fixConsole ?? (options.console !== false ? undefined : false),
â†’ 356:         fixDebugger: options.fixDebugger ?? (options.debugger !== false ? undefined : false),
  357:         fixAlert: options.fixAlert,
  358:         fixTsIgnore: options.fixTsIgnore,
  359:         fixAny: options.fixAny ?? (options.any !== false ? undefined : false),
  360:         fixComplexity: options.fixComplexity,
  361:         fixLongFunctions: options.fixLongFunctions,
```

**Suggested fix:**
```diff
+ Remove debugger statement before committing
```

> Fix lint issue

#### step-2: ðŸ”§ FIX ðŸ”´

**File**: `lib/@patterns/lint.ts:128`
**Effort**: 2 min

Unexpected debugger statement

**Current code:**
```typescript
  123: 
  124: /**
  125:  * Debugger line patterns
  126:  */
  127: export const DEBUGGER_LINE_PATTERNS = {
â†’ 128:   STANDALONE: /^debugger;?$/,
  129:   INLINE: /\bdebugger;?\s*/g,
  130: } as const;
  131: 
  132: /**
  133:  * Alert line patterns
```

**Suggested fix:**
```diff
+ Remove debugger statement before committing
```

> Fix lint issue

#### step-3: ðŸ”§ FIX ðŸ”´

**File**: `src/bin/cli.ts:283`
**Effort**: 5 min

@ts-ignore suppresses TypeScript errors

**Current code:**
```typescript
  278:     .option('--no-typecheck', 'Skip TypeScript check')
  279:     // Fixer flags - enable specific fixers
  280:     .option('--fix-console', 'Fix console.log statements')
  281:     .option('--fix-debugger', 'Fix debugger statements')
  282:     .option('--fix-alert', 'Fix alert() calls')
â†’ 283:     .option('--fix-ts-ignore', 'Fix @ts-ignore comments')
  284:     .option('--fix-any', 'Fix `any` type usage')
  285:     .option('--fix-complexity', 'Fix high complexity functions')
  286:     .option('--fix-long-functions', 'Fix long functions')
  287:     .option('--fix-magic-numbers', 'Fix magic numbers')
  288:     .option('--fix-urls', 'Fix hardcoded URLs')
```

**Suggested fix:**
```diff
+ Fix the type error instead of ignoring it
```

> Fix type-safety issue

#### step-4: ðŸ”„ REFACTOR ðŸ”´

**File**: `src/mcp/tools.ts:241`
**Effort**: 1h

Function "runTool" has complexity 29 (max: 10)

**Current code:**
```typescript
  236:  * @param name - Tool name (krolik_status, krolik_context, etc.)
  237:  * @param args - Tool arguments
  238:  * @param projectRoot - Project root directory
  239:  * @returns Tool execution result as string
  240:  */
â†’ 241: export function runTool(
  242:   name: string,
  243:   args: Record<string, unknown>,
  244:   projectRoot: string,
  245: ): string {
  246:   switch (name) {
```

**Suggested fix:**
```diff
+ Refactor into smaller functions, use strategy pattern, or extract conditions
```

> Fix complexity issue

#### step-5: ðŸ”„ REFACTOR ðŸ”´

**File**: `src/bin/cli.ts:52`
**Effort**: 1h

Function "createProgram" has complexity 33 (max: 10)

**Current code:**
```typescript
   47: }
   48: 
   49: /**
   50:  * Create main CLI program
   51:  */
â†’  52: function createProgram(): Command {
   53:   const program = new Command();
   54: 
   55:   program
   56:     .name('krolik')
   57:     .description('KROLIK â€” fast AI-assisted development toolkit (AI-friendly output by default)')
```

**Suggested fix:**
```diff
+ Refactor into smaller functions, use strategy pattern, or extract conditions
```

> Fix complexity issue

---

## File Contexts

Detailed information about affected files:

### `lib/@patterns/hardcoded.ts`

- **Purpose**: Module (main: shouldSkipFile)
- **Type**: util
- **Metrics**: 245 lines, 6 functions, avg complexity 2

**Exports**: `DETECTION_PATTERNS`, `FIXABLE_PATTERNS`, `ACCEPTABLE_NUMBERS`, `CONST_DECL_PATTERN`, `SKIP_FILE_PATTERNS`, `SKIP_URL_PATTERNS`, `KNOWN_CONSTANTS`, `KEYWORD_TO_CONST_NAME`, `shouldSkipFile`, `shouldSkipLine`, `isAcceptableNumber`, `shouldSkipUrl`, `getKnownConstantName`, `getConstNameFromKeyword`

### `mcp/tools.ts`

- **Purpose**: Module (main: runTool)
- **Type**: util
- **Metrics**: 350 lines, 5 functions, avg complexity 10

**Exports**: `TOOLS`, `runTool`

**Imports**: `node:child_process`, `node:url`, `./types`

### `mcp/resources.ts`

- **Purpose**: Module (main: getResources)
- **Type**: util
- **Metrics**: 113 lines, 2 functions, avg complexity 6

**Exports**: `getResources`, `ResourceContent`, `getResource`

**Imports**: `./types`

---

*Use `krolik fix --ai-execute AI-REPORT.md` to execute this plan automatically.*
